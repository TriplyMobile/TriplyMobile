# Data Model: Trip Detail Page

**Date**: 2025-01-27  
**Feature**: Trip Detail Page  
**Branch**: `001-trip-detail-page`

## Entity: Trip

**Collection**: `trips` (existing Firestore collection)

### Schema

```typescript
interface Trip {
  id: string;                    // Document ID (auto-generated by Firestore)
  name: string;                    // Required: Trip name/title
  startDate?: string;              // Optional: ISO 8601 format (YYYY-MM-DD)
  endDate?: string;                // Optional: ISO 8601 format (YYYY-MM-DD)
  countryDestination?: string;     // Optional: Country name (from predefined list)
  maxBudget?: number;              // Optional: Numeric budget value
  currency?: string;               // Optional: Currency code (e.g., "USD", "EUR", "GBP")
  description?: string;            // Optional: Trip description text
}
```

### Field Details

| Field | Type | Required | Format/Constraints | Notes |
|-------|------|----------|-------------------|-------|
| `id` | string | Yes | Firestore document ID | Auto-generated, immutable |
| `name` | string | Yes | Non-empty string, trimmed | Must be present to save |
| `startDate` | string | No | ISO 8601 (YYYY-MM-DD) | Date validation: must be valid date |
| `endDate` | string | No | ISO 8601 (YYYY-MM-DD) | Date validation: must be >= startDate if both present |
| `countryDestination` | string | No | From predefined country list | Selected via dropdown/autocomplete |
| `maxBudget` | number | No | Positive number | Numeric validation, no negative values |
| `currency` | string | No | ISO 4217 currency code | Examples: "USD", "EUR", "GBP" |
| `description` | string | No | Free text | No length limit specified |

### Validation Rules

1. **Name Field**:
   - Required: Cannot be empty or whitespace-only
   - Trimmed before save
   - Error: "Trip name is required"

2. **Date Fields**:
   - Both optional, but if both present: `endDate >= startDate`
   - Format validation: Must be valid ISO 8601 date (YYYY-MM-DD)
   - Error: "End date must be after start date"

3. **Budget Field**:
   - Must be numeric if provided
   - Should be positive (>= 0)
   - Error: "Budget must be a valid number"

4. **Country Field**:
   - Must be from predefined country list if provided
   - Error: "Please select a valid country"

### State Transitions

**Trip Lifecycle**:
1. **Created**: Trip document created in Firestore with at minimum `name` field
2. **Updated**: Trip fields modified via `updateDoc()` - partial updates supported
3. **Deleted**: Trip document removed from Firestore collection

**No explicit state field** - Firestore document existence represents state.

### Relationships

- **None**: Trip is a standalone entity
- **Future**: May relate to users, expenses, or other entities (out of scope for this feature)

### Firestore Operations

#### Read (Get Trip)
```typescript
import { doc, getDoc } from "firebase/firestore";

const tripRef = doc(db, "trips", tripId);
const tripSnap = await getDoc(tripRef);
if (tripSnap.exists()) {
  const tripData = { id: tripSnap.id, ...tripSnap.data() } as Trip;
}
```

#### Update (Edit Trip)
```typescript
import { doc, updateDoc } from "firebase/firestore";

const tripRef = doc(db, "trips", tripId);
await updateDoc(tripRef, {
  name: "Updated Trip Name",
  startDate: "2025-02-01",
  // ... other fields
});
```

#### Delete (Remove Trip)
```typescript
import { doc, deleteDoc } from "firebase/firestore";

const tripRef = doc(db, "trips", tripId);
await deleteDoc(tripRef);
```

### TypeScript Types

**Location**: `app/types/trip.ts` (to be created)

```typescript
export interface Trip {
  id: string;
  name: string;
  startDate?: string;
  endDate?: string;
  countryDestination?: string;
  maxBudget?: number;
  currency?: string;
  description?: string;
}

export interface TripFormData {
  name: string;
  startDate?: string;
  endDate?: string;
  countryDestination?: string;
  maxBudget?: string; // String for form input, converted to number
  currency?: string;
  description?: string;
}
```

### Constants

**Country List**: `app/constants/countries.ts` (to be created)
- Array of country objects with name and code
- Used for dropdown/autocomplete selection

**Currency List**: `app/constants/currencies.ts` (to be created)
- Array of currency objects with code and symbol
- Used for currency selection dropdown

### Notes

- **No schema migration needed**: Using existing `trips` collection
- **Backward compatible**: Existing trips may have different fields - handle gracefully
- **Partial updates**: Firestore `updateDoc` supports partial updates (only update provided fields)
- **Offline support**: Firestore offline persistence handles offline scenarios automatically
